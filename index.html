<html>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js">
	</script>
	<style>
	body {
	padding-top: 20%;
	margin: 0 auto;
	text-align: center;
	}
	</style>
	<body>
	<h1 id="main">Press Spacebar to start!</h1>
	</body>
	<script>
	var game_started = false;
	var tutorial_played = false;

	class Senario {
		constructor (ask, answers, retorts, recoverable) {
			this.waved = false;	
			this.asked = false;
			this.cur = 0;
			this.ask = ask;
			this.answers = answers;
			this.retorts = retorts;
			this.recoverable = recoverable;
		}
	}
	
	senario = [new Senario("Ask",["A 1", "A 2", "A 3"],
				["R 1", "R 2", "R 3"],0),
		new Senario("You think you see your friend, do you wave?",
			["They see you and you both enjoy a wave."],
			["You should wave to them!","It's them for sure.",
			"They come up to you and ask why you didn't wave."],
			2)];
	
	var wave_noise = new Audio('foo.wav');
	var wait_noise = new Audio('bar.wav');
	var interval_delay = 1000;
	var waves = 0;
	var waits = 0;
	var time_not_waving = 0;
	var senario_count = senario.length;
	var cur_senario = 0;

	setInterval(function() {
//		console.log("not_waving: " + time_not_waving +
//				"\nwaves: " + waves + 
//				"\nwaits: " + waits);	
		time_not_waving++;
		if (time_not_waving > 4)
		{
			console.log("Waited, no_wave");
			waits++;
			no_wave();
		}
		}, interval_delay);
	
	function wave() {
		if (waves == 0)
		{
			//Starting phase
			console.log("starting game");
			$("h1").text(senario[0].ask);
			senario[0].asked = true;
		}
		else if(cur_senario < senario_count)
		{
			console.log("Game Phase");
			//Game phase
			if(senario[cur_senario].asked)
			{
				console.log("Waved at ask in cur_senario: " + cur_senario);
				console.log("act " + senario[cur_senario].cur);
				senario[cur_senario].waved = true;	
				if (senario[cur_senario].cur < senario[cur_senario].answers.length)
				{
					console.log("answering");
					$("h1").text(senario[cur_senario].answers[senario[cur_senario].cur]);
					senario[cur_senario].cur++;
				}
				else
				{
					//End of answers
					console.log("Asking a new senario at end of answers");
					cur_senario++;
					if (cur_senario < senario_count)
					{
						$("h1").text(senario[cur_senario].ask);
						senario[cur_senario].asked = true;
					}
					else
					{
					console.log("nothing to do?");
					}
				}
			}
			else
			{	
				console.log("Asking a new senario");
				$("h1").text(senario[cur_senario].ask);
				senario[cur_senario].asked = true;	
			}
		}
		else
		{
			$("h1").text("The end, you waved " + waves + " times.");	
		}
		waves++;	
		time_not_waving = 0;
	}
	
	function no_wave() {
		if (waves == 0)
		{
			if (waits % 2)
				$("h1").text("Do you wave?");
			else
				$("h1").text("Press Spacebar to start!");

			console.log("no waves, game has not started.");
		}
		else if(cur_senario < senario_count)
		{
			console.log("didn't wave, in cur_senario " + cur_senario);
			console.log("act " + senario[cur_senario].cur);
			console.log(senario[cur_senario].waved + " already waved? ");
			if (senario[cur_senario].waved == true)
			{
				if (senario[cur_senario].cur < senario[cur_senario].answers.length)
					console.log("moving forward the answer, already waved");
				else
					console.log("We hit the end of the answers, and we didn't wave");
			}
			else
			{
				console.log("We didn't wave at an ask!");
			}
		}
		else
		{
			console.log("Out of senario_count's range?");	
		}
		time_not_waving = 0;
	}

	$(document).ready(function(){
		$("body").keypress(function(){
			wave();	
		});
	});
	</script>
</html>
